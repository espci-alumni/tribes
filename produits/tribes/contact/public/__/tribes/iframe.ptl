<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title></title>
<base target="iframe">
<script type="text/javascript" src="{base:'js/w'}"></script>
<!--[if lt IE 7]>
<style>body{behavior:url("{base:'fix/hover.htc'}")} select{behavior:url("{base:'fix/select.htc'}")} img,input{behavior:url("{base:'fix/png.htc'}");}</style>
<![endif]-->
<link rel="shortcut icon" href="{base:'favicon.ico'}" type="image/vnd.miscrosoft.icon" />
<style>
#iframe_body, #iframe_menu, #iframe_menuIEShadow, #iframe_main, #iframe
{
	position: absolute;

	top:    0;
	left:   0;
	right:  0;

	width:  100%;

	margin:  0;
	padding: 0;
	border:  0;
}

html
{
	overflow-x: hidden; /* Fix box-shadow overflow on full width layout */
}

#iframe_body, #iframe
{
	height: 100%;
	bottom: 0;
}

#iframe_menu, #iframe_menuIEShadow
{
	height: {$iframe_menu_height|default:0}px;

	-moz-box-shadow: 0 0 5px #aaa;
	-webkit-box-shadow: 0 0 5px #aaa;
	box-shadow: 0 0 5px #aaa;

	white-space: nowrap;
	overflow: hidden;
	z-index: 1;
}

#iframe_main
{
	top:    {$iframe_menu_height|default:0}px;
	bottom: 0px; /* use always pixel unit for IE7 and below */
}
</style>
<!--[if lt IE 9]>
<style>
#iframe_menuIEShadow
{
	display: block;
	top: -2px;
	left: -3px;
	background-color: white;
	width: 100%;
	filter:progid:DXImageTransform.Microsoft.Blur(PixelRadius=3,MakeShadow=true,ShadowOpacity=.15);
}
</style>
<![endif]-->
{$iframe_head}
</head>
<body>
<div id="iframe_body">
<!--[if lt IE 9]><div id="iframe_menuIEShadow"></div><![endif]-->
<div id="iframe_menu">{$iframe_menu}</div>
<div id="iframe_main"><iframe id="iframe" name="iframe" src="{$iframe_src|default:'/'}" frameborder="no" allowtransparency="true" onmouseover="window.updateIframe&&updateIframe()" onload="this.onmouseover()"></iframe></div>
</div>
<script>
var iframe = document.getElementById('iframe');

(function()
{
	var f = iframe,
		bSrc  = f.src,
		bUrl  = location.href,
		rUrl  = location.protocol + '//' + location.hostname + '/',
		fUrl  = fUrlGet(),
		fPath = fPathGet(fUrl);

	if ('' != location.hash) bUrl = bUrl.substr(0, bUrl.length - location.hash.length);
	else if ('#' == bUrl.substr(bUrl.length-1)) bUrl = bUrl.substr(0, bUrl.length-1);

	if (location.hash != fPath) location.replace(bUrl + fPath);

	f.src = fUrl;

	function fUrlGet()
	{
		var url = location.hash;

		url = rUrl + (url && url.substr(1).replace(/\s+$/, ''));

		return url != bUrl ? url : bSrc;
	}

	function fPathGet(url)
	{
		if (0 == url.indexOf(rUrl)) url = url.substr(rUrl.length);

		url = url.replace(/^\/+/, '');

		return '' != url ? '#' + url : '';
	}

	setInterval(function()
	{
		var fDoc;

		try
		{
			fDoc = f.contentDocument || frames['iframe'].contentWindow;

			if ('http' == fDoc.location.protocol.substr(0, 4))
			{
				if (fDoc.title && fDoc.title != document.title) document.title = fDoc.title;

				if (fDoc.location.href != fUrl)
				{
					fUrl = fDoc.location.href;

					fPath = fPathGet(fUrl);

					if (location.hash != fPath) location.replace(bUrl + fPath);

					return;
				}
			}
		}
		catch (e)
		{
			fDoc = 0;

			if ('' != fPath)
			{
				fPath = '';
				location.replace(bUrl + '#');

				return;
			}
		}

		switch (location.hash)
		{
		case fPath: return;
		case '#': if ('' == fPath) return;
		}

		fUrl  = fUrlGet();
		fPath = fPathGet(fUrl);

		if (location.hash != fPath) location.replace(bUrl + fPath);

		if (fDoc) fDoc.location.replace(fUrl);
		else f.src = fUrl;
	},
		200
	);

	window.updateIframe = function()
	{
		var a, r, i;

		try
		{
			// Workaround a webkit bug with non-transparent iframe + box-shadow on menu div

			if (navigator.userAgent.indexOf('WebKit'))
			{
				a = getComputedStyle(f.contentDocument.body, null).backgroundColor;

				if ('rgba(0, 0, 0, 0)' != a)
				{
					r = document.getElementById('iframe_main');
					i = getComputedStyle(r, null).backgroundColor;
					f.contentWindow.addEventListener('unload', function() {r.style.backgroundColor = i;});
					r.style.backgroundColor = a;
					f.contentDocument.body.style.backgroundColor='rgba(0, 0, 0, 0)';
				}
			}
		}
		catch (a) {}

		try
		{
			// Set external links' target to the current page (_parent);

			a = (f.contentDocument || frames['iframe'].contentWindow.document).getElementsByTagName('A'), i = a.length, r = rUrl;

			while (i--)
			{
				if (0 != a[i].href.indexOf(r) && !a[i].target)
				{
					a[i].target = '_parent';
				}
			}
		}
		catch (a) {}
	}
})();
</script>
<!--[if lt IE 8]>
<script>
(function()
{
var main = document.getElementById('iframe_main'), doc = document.documentElement, style = iframe.style;
(window.onresize = function() {style.height = (doc.clientHeight - main.offsetTop - parseInt(main.currentStyle.bottom)) + 'px';})()
})();
</script>
<![endif]-->
</body>
</html>
